# `IN`, `NOT IN`, `DISTINCT`, and Subqueries in SQL

This lesson introduces several powerful SQL features that enhance your ability to filter and retrieve specific data sets: the `IN` and `NOT IN` clauses, the `DISTINCT` keyword, and an initial look at **subqueries** (a `SELECT` statement nested within another `SELECT` statement).

## 1. `IN` and `NOT IN` Clauses

The `IN` and `NOT IN` clauses provide a concise way to filter records based on whether a column's value is present (or not present) in a specified list of values. This significantly simplifies queries that would otherwise require multiple `OR` conditions.

- **`IN`**: Retrieves rows where a column's value matches **any** value in a provided list.

  - **Syntax**: `column_name IN (value1, value2, value3, ...)`
  - **Example**: To select products with specific IDs (e.g., `4, 8, 10, 16`):
    ```sql
    SELECT *
    FROM products P
    WHERE P.prod_ID IN (4, 8, 10, 16);
    ```
    This is much more efficient and readable than:
    ```sql
    SELECT *
    FROM products P
    WHERE P.prod_ID = 4 OR P.prod_ID = 8 OR P.prod_ID = 10 OR P.prod_ID = 16;
    ```

- **`NOT IN`**: Retrieves rows where a column's value does **not** match any value in a provided list. It performs the inverse operation of `IN`.
  - **Syntax**: `column_name NOT IN (value1, value2, value3, ...)`
  - **Example**: To select all products _except_ those with IDs `4, 8, 10, 16`:
    ```sql
    SELECT *
    FROM products P
    WHERE P.prod_ID NOT IN (4, 8, 10, 16);
    ```

## 2. `DISTINCT` Keyword

The `DISTINCT` keyword (sometimes referred to as `DISTINCT ROW` in some contexts, though `DISTINCT` is the standard SQL keyword) is used in the `SELECT` clause to eliminate duplicate rows from your query results. It returns only the unique values for the specified column(s).

- **Syntax**: `SELECT DISTINCT column_name FROM TableName;`
- **Use Case**: When you want a list of unique items, rather than seeing every occurrence.
  - **Example**: To get a list of all unique product IDs that have been sold (without repetitions):
    ```sql
    SELECT DISTINCT prod_ID
    FROM sales_detail;
    ```
    If you run `SELECT prod_ID FROM sales_detail`, you might see the same `prod_ID` listed multiple times if it was sold in different transactions. `DISTINCT` ensures each `prod_ID` appears only once in the result.

## 3. Subqueries (Nested `SELECT` Statements)

A **subquery** is a `SELECT` statement nested inside another SQL query. Subqueries are powerful because they allow you to build complex queries by using the result of one query as input for another. In this lesson, we primarily see subqueries used with the `IN` and `NOT IN` clauses.

- **Use Case with `IN`/`NOT IN`**: Instead of providing a hardcoded list of values, you can use a subquery to dynamically generate that list from another table or set of conditions.

- **Example 1: Listing Products That Have NOT Been Sold**
  To find all products that do not appear in the `sales_detail` table:

  ```sql
  SELECT *
  FROM products P
  WHERE P.prod_ID NOT IN (
      SELECT DISTINCT BD.prod_ID -- Subquery: Gets a unique list of sold product IDs
      FROM sales_detail BD
  );
  ```

  Alternative version for SQLite:

  ```sql
    SELECT Prod_Id, Prod_Descripcion
    FROM productos
    WHERE Prod_Id NOT IN (SELECT DISTINCT VD_ProdId FROM ventas_detalle ORDER BY VD_ProdId)
  ```

  - **How it works**: The inner `SELECT DISTINCT BD.prod_ID` first retrieves a unique list of all product IDs present in the `sales_detail` table (i.e., all products that _have_ been sold). The outer query then uses `NOT IN` to select products from the `products` table whose IDs are _not_ in that list of sold products.

- **Example 2: Listing Clients Who Have Never Made a Purchase**
  To find clients present in the `clients` table but who do not have any records in the `sales` table:

  ```sql
  SELECT *
  FROM clients C
  WHERE C.cli_ID NOT IN (
      SELECT DISTINCT S.cli_ID -- Subquery: Gets a unique list of client IDs that have made sales
      FROM sales S
      -- WHERE YEAR(S.sale_date) = 2018 AND MONTH(S.sale_date) = 1 -- Optional filter within subquery
  );
  ```

  Alternative version for SQLite:

  ```sql
  SELECT Cli_Id, Cli_RazonSocial
  FROM clientes
  WHERE Cli_Id NOT IN (SELECT DISTINCT Ventas_CliId FROM ventas)
  ```

  - **Scope of Subqueries**: A subquery is an independent query. Variables or aliases defined in the outer query (`C` for `clients` in this example) are **not** accessible directly within the subquery. Similarly, aliases from the subquery are not accessible in the outer query's `WHERE` or `SELECT` clauses.

## Key Takeaways

- **`IN` / `NOT IN`**: Ideal for filtering based on a list of values, whether literal or generated by a subquery.
- **`DISTINCT`**: Essential for getting unique values when dealing with columns that might contain duplicates.
- **Subqueries**: Allow for dynamic list generation and more complex filtering logic, acting as building blocks for sophisticated queries. Subqueries can be used in various parts of a `SELECT` statement (not just `WHERE`), which you'll explore in more detail later.
